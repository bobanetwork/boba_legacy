name: Will trigger release of AA-Bundler to NPM (PR comment)
on:
  pull_request:
    branches:
      - master

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v3

     - uses: dorny/paths-filter@v2
       id: filter
       with:
        filters: |
          bundler_sdk:
            - 'packages/boba/bundler_sdk/**/*'
            - 'packages/boba/bundler_utils/**/*'

     - name: PR commenter
       if: steps.filter.outputs.bundler_sdk == 'true'
       uses: mshick/add-pr-comment@v2
       with:
          message: |
            ⚠️ **This PR triggers a minor release of the Bundler SDK** (Account Abstraction) to NPM as you made changes in the corresponding `bundler_sdk` directory.

            Please make sure this is intentional.

            The package that is going to be updated is `@bobanetwork/bundler_sdk`.

     - uses: MontyD/package-json-updated-action
       id: version-updated
       with:
          path: packages/boba/bundler_sdk/package.json

     - name: Increment patch version
       if: steps.version-updated.outputs.has-updated == 'false'
       working-directory: ./packages/boba/bundler_sdk
       run: npm version minor --legacy-peer-deps

     - name: setup git config
       if: steps.version-updated.outputs.has-updated == 'false'
       run: |
         git config user.name "GitHub Actions Bot"
         git config user.email "<>"

     - name: commit
       if: steps.version-updated.outputs.has-updated == 'false'
       run: |
         # Stage the file, commit and push
         git add packages/boba/bundler_sdk/package.json yarn.lock
         git commit -am "Bump Bundler SDK version"
         git push
         # $GITHUB_HEAD_REF
